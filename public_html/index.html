<!DOCTYPE html>
<html>
    <head>
        <title>MacPan</title>
        <link rel="shortcut icon" href="small_ghost_icon.ico">
        <link rel="stylesheet" href="stylesheet.css">
    </head>
    <body>
        <script src="createField.js"></script>
        <script src="player.js"></script>
        <script src="ghostAI.js"></script>
        <script src="score.js"></script>
        <script src="timer.js"></script>
        <script src="ghostGen.js"></script>
        <script src="startstopMoving.js"></script>
        <script src="randomPoint.js"></script>
        
        <script>
            var player;
            var ghosts = [];
            var size = 10;
            var coins = [];
            var clock;
            var start_time;
            var count = 0;
            var zz;
            var ghost_speed = 2;
            var pm;
            var isKeyDown = false;
            var keyDown;
            var speed = 50;//determines tick speed
            
            
            player = new PlayerCharacter("default", 10, 50, 50, 100);
            ghosts[0] = new ghost("ghost0", 500, 500, ghost_speed, 100);//frequency currently not implemented
            
            clock = new timer(100);
            
            document.addEventListener("keydown", startMoving, false);
            document.addEventListener("keyup", stopMoving, false);
            
            window.onload = function(){
                createField(size);
                player.loadCharacter();
                ghosts[0].loadGhost();
                clock.start();
                zz = setInterval(update, speed);
            };            
            
            function update(){
                count++;
                clock.getDisplayTime(clock);
                //for every 1 second, count increases by 20 -> 20 ticks/sec
                
                //does not take into account the ghosts' frequencies
                for(i=0; i<ghosts.length; i++){
                    ghosts[i].move(ghosts[i], player);
                }
                if(count % 10 === 0){
                    randomPoint(coins);
                }
                if(count % 800 === 0){
                    ghostGen(player, ghosts);
                }
                if(isKeyDown){
                    player.move(keyDown, coins);
                    player.loadCharacter();
                }
            }
            
            
            
            
            
            /*TODO
             * Obstacles HOW would the maze be generated?
             * Finish moving all updating to update()
             * Implement ghost.frequency
             * Detect multiple key presses at once (to enable diagonal movement)
             * OR Only one click required for continuous movement. Direction will change on another keypress. player.move would be in update()
             * Expiration time for coins OR another PacMan that eats the coins & can kill the player
             * Speed boost coins? Invincibility coins?
             * Ctrl and Shift effects?
             * Difficulty
             * Better playing character movement (currently choppy)
             * If time > 60, convert to minutes
             * 
             * 
             * BUGS
             * when the first additional ghost is loaded, the first one becomes invisible/disappears: FIXED
             * ghost movement speed too unbalanced: FIXED (kinda)
             * Timer and randomPoint() run even when the window isn't active. Ghost stops
             * Lag in player movement: FIXED
             * 
             * 
             * 
             */
        </script>
        <div id="score" class="top"></div>
        <div id="time" class="top"></div>
        <div id="game_text" class="top"></div>
    </body>
</html>